<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0078)http://le.mu.rs/motherfucker/Entries/2011/1/24_Legendary_Selections,_Dude.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="Generator" content="iWeb 3.0.2">
    <meta name="iWeb-Build" content="local-build-20110125">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
    <meta name="viewport" content="width=700">
    <title>motherfucker</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="./proper tableViewSelection_files/24_Legendary_Selections,_Dude.css">
    <!--[if lt IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='24_Legendary_Selections,_Dude_files/24_Legendary_Selections,_DudeIE.css'/><![endif]-->
    <!--[if gte IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='../../../../Media/IE8.css'/><![endif]-->
    <script language="javascript" type="text/javascript"><!--

iWebBlogMainPageName = 'motherfucker.html';
iWebBlogMainPageTitle = 'motherfucker';
iWebBlogArchivePageName = 'Archive.html';
iWebBlogArchivePageTitle = 'Archive';


--></script>
    <script type="text/javascript" src="./proper tableViewSelection_files/iWebSite.js"></script>
    <script type="text/javascript" src="./proper tableViewSelection_files/search.js"></script><script src="./proper tableViewSelection_files/loc.js" type="text/javascript" charset="utf-8"></script><script src="./proper tableViewSelection_files/utility.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="./proper tableViewSelection_files/iWebBlog.js"></script>
    <script type="text/javascript" src="./proper tableViewSelection_files/iWebImage.js"></script>
    <script type="text/javascript" src="./proper tableViewSelection_files/24_Legendary_Selections,_Dude.js"></script>
  </head>
  <body style="background: rgb(255, 255, 255) url(24_Legendary_Selections,_Dude_files/Pattern%20Browser.jpg) repeat scroll top left; margin: 0pt; " onload="onPageLoad();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 10px; margin-left: auto; margin-right: auto; margin-top: 10px; overflow: hidden; position: relative; word-wrap: break-word;  text-align: left; width: 700px; " id="body_content">
        <div style="background: transparent url(24_Legendary_Selections,_Dude_files/Typesetter_Page%20Tile2-2.jpg) repeat scroll top left; width: 700px; ">
          <div style="height: 70px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper">&nbsp;</div>
            <div style="height: 59px; width: 700px;  height: 59px; left: 0px; position: absolute; top: 0px; width: 700px; z-index: 1; " class="tinyText style_SkipStroke">
              <img src="./proper tableViewSelection_files/Typesetter Header3.jpg" alt="" style="border: none; height: 59px; width: 700px; ">
            </div>
            


            <div id="id1" style="height: 51px; left: 150px; position: absolute; top: 12px; width: 400px; z-index: 1; visibility: visible; " class="style_SkipStroke_1 shape-with-text">
              <div class="text-content Normal_External_400_51" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Header"><a title="../../../motherfucker.html" href="http://le.mu.rs/motherfucker/motherfucker.html">motherfucker</a></p>
                </div>
              </div>
              <div id="generic-header-attribute" class="Header"></div>
            </div>
            


            <div style="height: 29px; width: 48px;  height: 29px; left: 99px; position: absolute; top: 20px; width: 48px; z-index: 1; " class="tinyText style_SkipStroke_2">
              <img src="./proper tableViewSelection_files/Top Glyph.png" alt="" style="border: none; height: 29px; width: 48px; ">
            </div>
            


            <div style="height: 29px; width: 48px;  height: 29px; left: 553px; position: absolute; top: 20px; width: 48px; z-index: 1; " class="tinyText style_SkipStroke_2">
              <img src="./proper tableViewSelection_files/Top Glyph 2.png" alt="" style="border: none; height: 29px; width: 48px; ">
            </div>
          </div>
          <div style="float: left; margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper">&nbsp;</div>
            <div style="height: 146px; width: 699px;  height: 146px; left: 0px; position: absolute; top: -146px; width: 699px; z-index: 1; " class="tinyText style_SkipStroke">
              <img src="./proper tableViewSelection_files/Seperator 3-6.jpg" alt="" style="border: none; height: 146px; width: 699px; ">
            </div>
            


            <div style="height: 146px; width: 699px;  height: 146px; left: 0px; position: absolute; top: -146px; width: 699px; z-index: 1; " class="tinyText style_SkipStroke">
              <img src="./proper tableViewSelection_files/Seperator 3-5.jpg" alt="" style="border: none; height: 146px; width: 699px; ">
            </div>
            


            <div style="height: 146px; width: 699px;  height: 146px; left: 0px; position: absolute; top: -146px; width: 699px; z-index: 1; " class="tinyText style_SkipStroke">
              <img src="./proper tableViewSelection_files/Seperator 3-6_1.jpg" alt="" style="border: none; height: 146px; width: 699px; ">
            </div>
            <div style="clear: both; height: 0px; line-height: 0px; " class="spacer">&nbsp;</div>
          </div>
          <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper">&nbsp;</div>
            <div style="height: 1px; line-height: 1px; " class="tinyText">&nbsp;</div>
            <div style="margin-left: 115px; margin-top: 290px; position: relative; width: 470px; z-index: 1; visibility: visible; " class="style_SkipStroke_3 shape-with-text flowDefining">
              <div class="text-content Normal_External_470_2491" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-top: 0pt; " class="Body">If you are a Cocoa programmer, hell, if you’re just any old Mac user, you probably know how selecting things in a Finder window works, right? When you click on something, it selects it. When you click on something else, it deselects that other thing, and selects the new thing. So far, so good.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">But let’s say you want to select multiple things. No problem! You hold down the command key, and now you can click on things to select them without deselecting anything else. If you are a real pro, you know that command-clicking something that’s already selected will deselect just that one thing.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Right about now you’re probably thinking, “Why are you boring me with this crap? I know how Finder selections work.” OK smart guy, tell me this: in the picture above, what happens if you hold the shift key and click on the folder labeled 6?<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">You might think it will select folders 0-6, because isn’t that how shift-clicking something works? Does it? Or does it select folders 6-B because shift-clicking creates a selection contiguous to the closest selection? Or does it?<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Go ahead, open a Finder window, put it in column view mode (or, as Matt Legend Gemmell calls it, the View of Champions) and give it a try. You will probably find it selects folders 6-F.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">I say <span class="style">probably</span>, because you are <span class="style">probably</span> going to click folder 0, then command-click folders B, D, and F, then shift-click folder 6. But you might not, in which case, you will get some other result, because the order in which you select the other folders affects the behavior of shift-clicking.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Completely unexpected? I’m not surprised. Not even Uli Kusterer knew this stuff, and if Uli doesn’t know something, I figure nobody does. <br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Which brings me to this stoner-esque question: Dude, have you ever, you know, just really stopped to look at selection behavior in the Finder. It's so weird, man. Like totally trippy.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">If you’re not a software engineer building apps for the Mac, none of this really matters. It’s just an interesting bit of trivia you can use to not really impress anyone. <br></p>
                  <p class="Body"><br></p>
                  <p class="Body">If you <span class="style">are</span> a software engineer building apps for the Mac, buckle up, because like Past Me, you have no fucking idea how these selections work, which is a real problem, because one day you are going to implement selection behavior in your app and completely fuck it up.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">The metakey click selection behavior in the Finder’s View of Champions is the same as in NSTableView and friends, and should be considered the canonical selection behavior. It is, as you are about to discover, bizarre, and not necessarily correct, but it is better to be consistent than to be correct.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Here’s the crazy fucked up thing about shift-click selections—they depend on the last item you clicked on, regardless of whether that item was actually selected.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">If you click on the folders in the above example in the opposite order, from F to 0, shift-clicking on folder 6 will select folders 0-6. If, on the other hand, you were to command-click folder B off and on again, shift-clicking on folder 6 will select folders 6-B.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">If you deselect folder C, clicking on folder 6 will select folders 6-F. Unless you were to click folder A off and on again, in which case, it would select folders 6-B again. And so forth.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Confused yet? No? Then try repeating these experiments upside down, with folders 0, 2, 4, and F selected.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">When you think you’ve figured it out, try this: close the test folder and reopen it so you can start fresh with no selections at all. Then, shift-click folder 6. That should select folders 0-6. Shift-clicking folder 4 selects folders 0-4. Shift clicking folder 8 selects folders 0-8.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Now, with folders 0-8 selected, command-click folder F on and off again. Then, shift-click folder A. If your mind isn’t blown, you haven’t been following along, because that shit is <span class="style">fucked up</span>.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">This is all I did today, for something like 12 hours, reverse engineering the Finder. Why? Because I needed my selections to be perfect, which is to say, I needed them to behave just like any other selections on the system.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Any good engineer is a great reverse engineer, and nowhere is this more true than when building apps, because in order to make apps that don’t suck, you have to make apps that are consistent with the behavior established for their platform. Whenever I have to implement something for MacOS or iOS, the first question I ask is, “how does Apple do it?”<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Then, if you’re really cool, you’ll turn around and tell other people what you figured out, which is why I am writing this blog entry, in the hopes that one day someone will invent a search engine that can actually find shit like this when other people are trying to figure it out on their own.<br></p>
                  <p class="Body"><br></p>
                  <p class="paragraph_style">Implementing canonical selections<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">When it comes to implementing shift-click selections, there are two big things you need to be aware of: how the selection range is determined, and how other selections are affected. Both of these depend on discovering what I will call the baseIndex.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">I say index, because we’re essentially dealing with an NSArray of items that form your list, and the best way to keep track of what’s selected in an NSArray is with an NSIndexSet, which we’ll call selectedIndexes.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">The selection range will be between the baseIndex and the item you shift-clicked on, which I’ll call the clickIndex. Once you have those two things, you can express the selected range with the following NSIndexSet:<br></p>
                  <p class="Body"><br></p>
                  <p class="paragraph_style_1">[<span class="style_1">NSIndexSet</span> indexSetWithIndexesInRange:NSMakeRange(<span class="style_2">MIN</span>(<span class="style_3">baseIndex</span>, <span class="style_3">clickIndex</span>), abs(<span class="style_3">clickIndex</span> - <span class="style_3">baseIndex</span>) + <span class="style_4">1</span>)]<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">So how do you figure out baseIndex? The short answer is that baseIndex is the last item you clicked on without pressing the shift key. So basically, in your mouseUp: method, once you figure out what the user clicked on, stash that away somewhere, except in the case where you’re handling shift-click.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">As an aside, let’s get this straight: the order goes NSCommandKeyMask then NSShiftKeyMask. If the user is pressing both, only NSCommandKeyMask counts, got it?<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">OK, where were we? Oh yes, baseIndex. Most of the time just remembering the last thing the user clicked on is enough, but it’s not quite right, because the item at baseIndex might not actually be selected, so you have to run it through this handy little algorithm:<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">If baseIndex is selected, use it. Otherwise,<br></p>
                  <p class="Body">baseIndex is the next highest selected index. If there isn’t one,<br></p>
                  <p class="Body">baseIndex is the next lowest selected index. If there isn’t one,<br></p>
                  <p class="Body">Huh. Must not be any selections. baseIndex is 0.<br></p>
                  <p class="Body"><br></p>
                  <p class="Body">Or, in code:<br></p>
                  <p class="Body"><br></p>
                  <p class="paragraph_style_2"><span class="style_1">NSUInteger</span> originalBaseIndex = <span class="style_3">baseIndex</span>;<br></p>
                  <p class="paragraph_style_1"><span class="style_3">baseIndex</span> = [<span class="style_3">selectedIndexes</span> indexGreaterThanOrEqualToIndex:<span class="style_5">originalBaseIndex</span>];<br></p>
                  <p class="paragraph_style_3"><span class="style_6">if</span> <span class="style_7">(</span>baseIndex <span class="style_7">==</span> <span class="style_8">NSNotFound</span><span class="style_7">)</span><br></p>
                  <p class="paragraph_style_3">&nbsp;&nbsp;&nbsp; baseIndex <span class="style_7">=</span> <span class="style_8">[</span>selectedIndexes <span class="style_8">indexLessThanIndex:</span><span class="style_5">originalBaseIndex];</span><br></p>
                  <p class="paragraph_style_3"><span class="style_6">if</span> <span class="style_7">(</span>baseIndex <span class="style_7">==</span> <span class="style_8">NSNotFound</span><span class="style_7">)</span><br></p>
                  <p class="paragraph_style_2">&nbsp;&nbsp;&nbsp; <span class="style_3">baseIndex</span> = <span class="style_4">0</span>;<br></p>
                  <p class="paragraph_style_4"><br></p>
                  <p class="Body">Once we have baseIndex, we have our selected range, but how do we fold those into the existing selections? Like the problem of the base index, it’s weird to see in practice, but easy to imagine in terms of an NSIndexSet. <br></p>
                  <p class="Body"><br></p>
                  <p class="Body">I’m not going to code it for you, because it’s after midnight here in Taiwan, and I have a 6 a.m. flight to Cambodia, but the algorithm is pretty straightforward.<br></p>
                  <p class="Body"><br></p>
                  <p style="padding-bottom: 0pt; " class="Body">Create a set of all indexes (or as I like to say, indices) that are contiguous with baseIndex, deselect those, then merge what’s left to the new selection range, and voila, proper shift-click selections.</p>
                </div>
              </div>
              <div id="generic-body-attributes" class="Body"></div>
            </div>
            


            <div id="id2" style="height: 141px; left: 394px; position: absolute; top: 92px; width: 130px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
              <div class="text-content graphic_textbox_layout_style_default_External_130_141" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Quote">Any good engineer is a great reverse engineer, and nowhere is this more true than when building apps</p>
                </div>
              </div>
            </div>
            


            <div id="id3" style="height: 24px; left: 115px; position: absolute; top: 266px; width: 470px; z-index: 1; visibility: visible; " class="style_SkipStroke_5 shape-with-text">
              <div class="text-content style_External_470_24" style="padding: 0px; ">
                <div class="style_9">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Date">Monday, January 24, 2011</p>
                </div>
              </div>
              <div id="generic-datefield-attributes" class="Date"></div>
            </div>
            


            <div style="height: 200px; width: 266px;  height: 200px; left: 117px; position: absolute; top: 31px; width: 266px; z-index: 1; " class="tinyText stroke_0">
              <div style="position: relative; width: 266px; ">
                <img src="./proper tableViewSelection_files/shapeimage_1.png" alt="" style="height: 200px; left: 0px; position: absolute; top: 0px; width: 266px; visibility: visible; " id="generic-picture-attributes">
              </div>
            <img src="./proper tableViewSelection_files/stroke.png" style="position: absolute; left: -2px; top: -1px; width: 1px; height: 202px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_1.png" style="position: absolute; left: -2px; top: -2px; width: 1px; height: 1px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_2.png" style="position: absolute; left: -1px; top: -2px; width: 268px; height: 1px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_3.png" style="position: absolute; left: 267px; top: -2px; width: 1px; height: 1px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_4.png" style="position: absolute; left: 267px; top: -1px; width: 1px; height: 202px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_5.png" style="position: absolute; left: 267px; top: 201px; width: 1px; height: 1px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_6.png" style="position: absolute; left: -1px; top: 201px; width: 268px; height: 1px;z-index: auto;"><img src="./proper tableViewSelection_files/stroke_7.png" style="position: absolute; left: -2px; top: 201px; width: 1px; height: 1px;z-index: auto;"></div>
            


            <div style="height: 1px; width: 655px;  height: 1px; left: 22px; position: absolute; top: -1px; width: 655px; z-index: 1; " class="tinyText">
              <div style="position: relative; width: 655px; ">
                <img src="./proper tableViewSelection_files/shapeimage_2.jpg" alt="" style="height: 1px; left: 0px; position: absolute; top: 0px; width: 655px; ">
              </div>
            </div>
            


            <div style="height: 1px; width: 655px;  height: 1px; left: 22px; position: absolute; top: 2px; width: 655px; z-index: 1; " class="tinyText">
              <div style="position: relative; width: 655px; ">
                <img src="./proper tableViewSelection_files/shapeimage_3.jpg" alt="" style="height: 1px; left: 0px; position: absolute; top: 0px; width: 655px; ">
              </div>
            </div>
            


            <div id="id4" style="height: 32px; left: 115px; position: absolute; top: 237px; width: 470px; z-index: 1; visibility: visible; " class="style_SkipStroke_6 shape-with-text">
              <div class="text-content Normal_External_470_32" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Title">Legendary Selections, Dude</p>
                </div>
              </div>
              <div id="generic-title-attributes" class="Title"></div>
            </div>
            <div style="height: 0px; line-height: 0px; " class="spacer">&nbsp;</div>
          </div>
          <div style="height: 170px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper">&nbsp;</div>
            <div style="height: 90px; width: 700px;  height: 90px; left: 0px; position: absolute; top: 80px; width: 700px; z-index: 1; " class="tinyText style_SkipStroke_2">
              <img src="./proper tableViewSelection_files/Typesetter Footer4.jpg" alt="" style="border: none; height: 90px; width: 700px; ">
            </div>
            


            <div style="height: 1px; width: 655px;  height: 1px; left: 22px; position: absolute; top: 76px; width: 655px; z-index: 1; " class="tinyText">
              <div style="position: relative; width: 655px; ">
                <img src="./proper tableViewSelection_files/shapeimage_4.jpg" alt="" style="height: 1px; left: 0px; position: absolute; top: 0px; width: 655px; ">
              </div>
            </div>
            


            <div style="height: 1px; width: 655px;  height: 1px; left: 22px; position: absolute; top: 79px; width: 655px; z-index: 1; " class="tinyText">
              <div style="position: relative; width: 655px; ">
                <img src="./proper tableViewSelection_files/shapeimage_5.jpg" alt="" style="height: 1px; left: 0px; position: absolute; top: 0px; width: 655px; ">
              </div>
            </div>
            <a href="http://apple.com/mac" title="http://apple.com/mac"><img src="./proper tableViewSelection_files/mwmac.png" alt="Made on a Mac" style="border: none; height: 50px; left: 280px; opacity: 0.35; position: absolute; top: 95px; width: 139px; z-index: 1; " id="id5">

</a>
            <div id="id6" style="height: 26px; left: 100px; position: absolute; top: 17px; width: 250px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
              <div class="text-content graphic_textbox_layout_style_default_External_250_26" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <div class="paragraph Previous" style="padding-bottom: 0pt; padding-top: 0pt; "><span class="style_10"></span><div style="height: 14px; width: 20px;  height: 14px; position: relative; top: 4px; width: 20px; " class="tinyText style_SkipStroke_7 inline-block"><a href="http://le.mu.rs/motherfucker/Entries/2011/1/15_Like_a_Good_Neighbor.html" title="Like a Good Neighbor" class="iWebBlogPrev"><img src="./proper tableViewSelection_files/arrowleft.png" alt="" style="border: none; height: 14px; width: 20px; "></a></div><span class="style_10"></span> <a class="iWebBlogPrev" title="Like a Good Neighbor" href="http://le.mu.rs/motherfucker/Entries/2011/1/15_Like_a_Good_Neighbor.html">Previous</a></div>
                </div>
                <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText">&nbsp;</div>
              </div>
            </div>
            


            <div id="id7" style="height: 26px; left: 350px; position: absolute; top: 17px; width: 235px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
              <div class="text-content graphic_textbox_layout_style_default_External_235_26" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <div class="paragraph Next" style="padding-bottom: 0pt; padding-top: 0pt; "><a class="iWebBlogNext" title="Archive" href="http://le.mu.rs/motherfucker/Archive.html">Next</a> &nbsp;<span class="style_10"></span><div style="height: 14px; width: 20px;  height: 14px; position: relative; top: 4px; width: 20px; " class="tinyText style_SkipStroke_7 inline-block"><a href="http://le.mu.rs/motherfucker/Archive.html" title="Archive" class="iWebBlogNext"><img src="./proper tableViewSelection_files/arrowright.png" alt="" style="border: none; height: 14px; width: 20px; "></a></div><span class="style_10"></span></div>
                </div>
                <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText">&nbsp;</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  



</body></html>